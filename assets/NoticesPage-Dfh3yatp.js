import{j as s,I as T,r as o,A,u as U,v as b,C as K,e as $,f as O,D as V,h as _,g as H}from"./index-DoziOfyJ.js";import{F as J,P as W}from"./FindForm-BUMHeTUv.js";import{N as X}from"./NoticeCard-B2F-dEYd.js";import{u as Y,C as Z}from"./index.esm-CVND3_uw.js";import{c as Q,a as w,o as ee}from"./index.esm-T-8WkfIw.js";import"./formatDate-Cl6MRW5r.js";const se=({setSearchQuery:t,text:r,isActive:n,onClick:c})=>{const i=()=>{t(a=>({...a,sort:n?"":r})),c()};return s.jsx("div",{className:"button-wrap",children:s.jsxs("button",{type:"submit",className:`sort-button ${n?"cross":""}`,onClick:i,children:[r,n&&s.jsx(T,{className:"icon-cross",name:"close"})]})})},te=(t,r,n)=>{o.useEffect(()=>{const c=a=>{a.code==="Escape"&&t(!1)},i=a=>{r.current&&!r.current.contains(a.target)&&(n!=null&&n.current)&&!(n!=null&&n.current.contains(a.target))&&t(!1)};return window.addEventListener("keydown",c),document.addEventListener("mousedown",i),()=>{window.removeEventListener("keydown",c),document.removeEventListener("mousedown",i)}},[t,r,n])},v=A.forwardRef(({onSelect:t,onClose:r,data:n},c)=>{const i=l=>{t(l)},a=()=>{t("")},e=o.useRef(null);return te(r,e,c),s.jsx("div",{className:"menu-modal",children:s.jsx("div",{className:"menu-modal-container",children:s.jsxs("ul",{className:"menu-categories-list",ref:e,children:[s.jsx("li",{className:"menu-categories-item",onClick:a,children:"Show all"}),n&&n.map(l=>s.jsx("li",{className:"menu-categories-item",onClick:()=>i(l),children:l},l))]})})})}),ne=["unknown","female","male","multiple"],ae=["dog","cat","monkey","bird","snake","turtle","lizard","frog","fish","ants","bees","butterfly","spider","scorpion"],oe=["sell","free","lost","found"],P=({placeholder:t,setSearchQuery:r})=>{const n=Q({category:w(),sex:w(),species:w()}).required(),{handleSubmit:c,control:i,setValue:a}=Y({resolver:ee(n)}),e=U(),l=o.useRef(null),g=o.useRef(null),p=o.useRef(null),u=o.useRef(null),[f,q]=b(),[x,k]=o.useState(f.get("category")??""),[j,E]=o.useState(f.get("sex")??""),[h,R]=o.useState(f.get("species")??""),[F,C]=o.useState(!1),[B,S]=o.useState(!1),[L,y]=o.useState(!1),M=d=>{r(m=>({...m,...d})),D(d),e(K(1))},z=()=>{t==="Category"?C(!F):t==="By gender"?S(!B):y(!L)},N=d=>{const m={};t==="Category"?(k(d),m.category=d||void 0):t==="By gender"?(E(d),m.sex=d||void 0):(R(d),m.species=d||void 0),C(!1),S(!1),y(!1),D(m),c(M)()},D=d=>{const m=new URLSearchParams(f);Object.entries(d).forEach(([G,I])=>{I?m.set(G,I):m.delete(G)}),q(m)};return o.useEffect(()=>{k(f.get("category")??""),E(f.get("sex")??""),R(f.get("species")??"")},[f]),o.useEffect(()=>{a("category",x||""),a("sex",j||""),a("species",h||"")},[x,j,h,a]),s.jsx("form",{onSubmit:c(M),ref:l,className:"form",children:s.jsxs("div",{className:`find-form-wrap ${t==="Category"||t==="By gender"?"category":t==="By type"?"type":""}`,children:[s.jsx(Z,{name:t==="Category"?"category":t==="By gender"?"sex":"species",control:i,render:({field:d})=>s.jsx("input",{...d,className:"input find-input",placeholder:t,value:t==="Category"?x:t==="By gender"?j:h})}),s.jsx("button",{type:"button",className:"find-form-button",onClick:z,ref:t==="Category"?g:t==="By gender"?p:u,children:s.jsx("div",{className:"find-form-icon",children:s.jsx(T,{name:"chevron-down",className:"icon-search"})})}),F&&s.jsx(v,{onSelect:N,onClose:()=>C(!1),ref:g,data:oe}),B&&s.jsx(v,{onSelect:N,onClose:()=>S(!1),ref:p,data:ne}),L&&s.jsx(v,{onSelect:N,onClose:()=>y(!1),ref:u,data:ae})]})})},ce=({setSearchQuery:t})=>{const[r,n]=b(),c=r.get("sort"),i=a=>{const e=c===a?"":a;t(g=>({...g,sort:e}));const l=new URLSearchParams(r);e?l.set("sort",e):l.delete("sort"),n(l)};return s.jsx(s.Fragment,{children:s.jsxs("div",{className:"notices-form-wrap",children:[s.jsxs("div",{className:"notices-form-top",children:[s.jsx(J,{setSearchQuery:t,placeholder:"Search"}),s.jsx(P,{setSearchQuery:t,placeholder:"Category"}),s.jsx(P,{setSearchQuery:t,placeholder:"By gender"}),s.jsx(P,{setSearchQuery:t,placeholder:"By type"})]}),s.jsx("div",{className:"notices-stroke"}),s.jsx("div",{className:"sort-button-wrap",children:["Popular","Unpopular","Cheap","Expensive"].map(a=>s.jsx(se,{setSearchQuery:t,text:a,isActive:c===a.toLowerCase(),onClick:()=>i(a.toLowerCase())},a))})]})})},ge=()=>{const t=$(O),r=6,[n,c]=b();o.useEffect(()=>{n.has("page")||c({page:"1"})},[n,c]);const i=Number(n.get("page"))||1,a=$(V),[e,l]=o.useState({title:n.get("title")||null,category:n.get("category")||null,sex:n.get("sex")||null,species:n.get("species")||null,sort:n.get("sort")||null}),g=U();o.useEffect(()=>{const u={page:i,limit:r,title:e!=null&&e.title?e.title:null,category:e!=null&&e.category?e.category:null,sex:e!=null&&e.sex?e.sex:null,species:e!=null&&e.species?e.species:null,sort:e!=null&&e.sort?e==null?void 0:e.sort:null};g(_()),g(H(u))},[i,g,e]);const p=u=>{c({page:String(u),...e.title&&{title:String(e.title)},...e.category&&{category:String(e.category)},...e.sex&&{sex:String(e.sex)},...e.species&&{species:String(e.species)}})};return s.jsxs("div",{className:"notices-container",children:[s.jsxs("div",{className:"notices-main-wrap",children:[s.jsx("h2",{className:"notices-main-title",children:"Find your favorite pet"}),s.jsx(ce,{setSearchQuery:l})]}),s.jsx("div",{className:"news-cards notices-cards",children:t&&t.length>0?t.map(u=>s.jsx(X,{data:u},u._id)):s.jsx("p",{children:"There are news yet"})}),a&&s.jsx(W,{totalItems:a,currentPage:i,onPageChange:p})]})};export{ge as default};
